{
  "main_questline": [
    {
      "id": "pilgrims_last_angle",
      "name": "The Pilgrim's Last Angle",
      "description": "A dying pilgrim speaks of doors that still remember and angles that reveal truth. Find their cache before the next storm overwrites the path.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "find_dying_pilgrim",
          "description": "Find the dying pilgrim in the salt wastes",
          "type": "talk_to",
          "npc_id": "dying_pilgrim"
        },
        {
          "id": "recover_cache",
          "description": "Recover the pilgrim's cache before the storm",
          "type": "collect",
          "item_id": "scripture_shard",
          "count": 1
        },
        {
          "id": "return_to_pilgrim",
          "description": "Return to the dying pilgrim with the scripture shard",
          "type": "talk_to",
          "npc_id": "dying_pilgrim"
        }
      ],
      "reward": {
        "xp": 50,
        "items": ["scripture_shard"],
        "salt_scrip": 100,
        "unlocks_quests": ["the_broken_key"]
      },
      "criteria": {
        "requires_quests_completed": [],
        "custom_conditions": ["first_time_player"]
      }
    },
    {
      "id": "the_broken_key",
      "name": "The Broken Key",
      "description": "The scripture shard speaks of saint-keys and doors that remember. Investigate the ruins where the first key lies broken.",
      "category": "main", 
      "act": 1,
      "objectives": [
        {
          "id": "investigate_ruins",
          "description": "Investigate the vitrified library ruins (50, 50)",
          "type": "reach",
          "x": 50,
          "y": 50
        },
        {
          "id": "examine_broken_key",
          "description": "Examine the broken saint-key",
          "type": "collect",
          "item_id": "broken_saint_key",
          "count": 1
        }
      ],
      "reward": {
        "xp": 75,
        "items": ["broken_saint_key"],
        "salt_scrip": 150,
        "unlocks_quests": ["faction_choice_monks", "faction_choice_engineers", "faction_choice_glassborn"]
      },
      "criteria": {
        "requires_quests_completed": ["pilgrims_last_angle"]
      }
    },
    {
      "id": "faction_choice_monks",
      "name": "The Mirror Monk Path",
      "description": "Brother Halix offers to teach you the sacred angles. The Mirror Monks see patterns in the storm that others cannot.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_halix",
          "description": "Speak with Brother Halix about the sacred angles",
          "type": "talk_to",
          "npc_id": "brother_halix"
        },
        {
          "id": "storm_walk_ritual",
          "description": "Complete the storm-walk ritual during a glass storm",
          "type": "reach",
          "x": 25,
          "y": 25
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["sacred_angle_lens"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Mirror Monks": 25
        },
        "max_faction_reputation": {
          "Sand-Engineers": 50,
          "Glassborn": 50
        }
      }
    },
    {
      "id": "faction_choice_engineers", 
      "name": "The Sand-Engineer Path",
      "description": "Forewoman Ressa Vane offers practical solutions. The Sand-Engineers believe in controlling the storms through technology.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_ressa",
          "description": "Speak with Forewoman Ressa Vane about storm forecasting",
          "type": "talk_to",
          "npc_id": "forewoman_ressa"
        },
        {
          "id": "build_forecast_tool",
          "description": "Gather components to build a storm forecast instrument",
          "type": "collect",
          "item_id": "forecast_instrument",
          "count": 1
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["forecast_instrument", "spoof_module"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Sand-Engineers": 25
        },
        "max_faction_reputation": {
          "Mirror Monks": 50,
          "Glassborn": 50
        }
      }
    },
    {
      "id": "faction_choice_glassborn",
      "name": "The Glassborn Path", 
      "description": "Sable-of-the-Seam speaks of kinship and transformation. The Glassborn embrace the storm's changes.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_sable",
          "description": "Speak with Sable-of-the-Seam about the crucible rites",
          "type": "talk_to",
          "npc_id": "sable_of_the_seam"
        },
        {
          "id": "crucible_rite",
          "description": "Survive a high-intensity storm in the marked crucible zone",
          "type": "reach",
          "x": 75,
          "y": 75
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["storm_glass"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Glassborn": 25
        },
        "max_faction_reputation": {
          "Mirror Monks": 50,
          "Sand-Engineers": 50
        },
        "min_refraction": 50
      }
    },
    {
      "id": "the_second_key",
      "name": "The Second Key",
      "description": "With faction backing, seek an intact saint-key. Each faction offers a different path to this crucial artifact.",
      "category": "main",
      "act": 2,
      "objectives": [
        {
          "id": "acquire_intact_key",
          "description": "Acquire an intact saint-key through your chosen faction",
          "type": "collect",
          "item_id": "saint_key",
          "count": 1
        }
      ],
      "reward": {
        "xp": 200,
        "items": ["saint_key"],
        "salt_scrip": 500,
        "unlocks_quests": ["custodians_query"]
      },
      "criteria": {
        "requires_quests_completed": ["faction_choice_monks", "faction_choice_engineers", "faction_choice_glassborn"],
        "custom_conditions": ["has_faction_alignment"]
      }
    },
    {
      "id": "custodians_query",
      "name": "The Custodian's Query",
      "description": "With a saint-key in hand, approach Custodian IRI-7 in the Deep Archive. Prepare to learn the truth of White Noon.",
      "category": "main",
      "act": 3,
      "objectives": [
        {
          "id": "enter_deep_archive",
          "description": "Enter the Deep Archive Wing",
          "type": "reach",
          "x": 100,
          "y": 100
        },
        {
          "id": "interface_with_custodian",
          "description": "Interface with Custodian IRI-7",
          "type": "talk_to",
          "npc_id": "custodian_iri_7"
        }
      ],
      "reward": {
        "xp": 500,
        "salt_scrip": 1000,
        "unlocks_quests": ["white_noon_revelation"]
      },
      "criteria": {
        "requires_quests_completed": ["the_second_key"],
        "required_items": ["saint_key"],
        "custom_conditions": ["in_deep_archive"]
      }
    },
    {
      "id": "white_noon_revelation",
      "name": "The White Noon Revelation",
      "description": "Custodian IRI-7 reveals the truth of White Noon—not an accident, but sabotage by the Preservation Protocol. The Architect's Great Work was interrupted.",
      "category": "main",
      "act": 3,
      "objectives": [
        {
          "id": "learn_white_noon_truth",
          "description": "Learn the truth about White Noon from Custodian IRI-7",
          "type": "talk_to",
          "npc_id": "custodian_iri_7"
        },
        {
          "id": "confront_architect",
          "description": "Confront The Architect with the truth",
          "type": "talk_to",
          "npc_id": "the_architect"
        }
      ],
      "reward": {
        "xp": 750,
        "salt_scrip": 1500,
        "unlocks_quests": ["prime_lens_prophecy"]
      },
      "criteria": {
        "requires_quests_completed": ["custodians_query"]
      }
    },
    {
      "id": "prime_lens_prophecy",
      "name": "The Prime Lens Prophecy",
      "description": "The Architect reveals the Prime Lens—a master key that can focus the entire Heliograph array. It was shattered into three Aspects during White Noon.",
      "category": "main",
      "act": 3,
      "objectives": [
        {
          "id": "learn_prime_lens_location",
          "description": "Learn about the three Prime Lens Aspects from The Architect",
          "type": "talk_to",
          "npc_id": "the_architect"
        },
        {
          "id": "choose_first_aspect",
          "description": "Choose which Prime Lens Aspect to seek first",
          "type": "collect",
          "item_id": "prime_lens_shard",
          "count": 1
        }
      ],
      "reward": {
        "xp": 1000,
        "items": ["prime_lens_shard"],
        "salt_scrip": 2000,
        "unlocks_quests": ["shard_of_clarity", "shard_of_will", "shard_of_soul"]
      },
      "criteria": {
        "requires_quests_completed": ["white_noon_revelation"]
      }
    },
    {
      "id": "shard_of_clarity",
      "name": "The Shard of Clarity",
      "description": "Seek the Shard of Clarity in the deepest databanks of the Archive Core. Face the Logic-Gatekeeper to claim the Mind aspect.",
      "category": "main",
      "act": 4,
      "objectives": [
        {
          "id": "enter_archive_core",
          "description": "Enter the Archive Core's deepest level",
          "type": "reach",
          "x": 150,
          "y": 150
        },
        {
          "id": "defeat_logic_gatekeeper",
          "description": "Defeat or outwit the Logic-Gatekeeper",
          "type": "kill",
          "enemy_id": "logic_gatekeeper",
          "count": 1
        },
        {
          "id": "claim_clarity_shard",
          "description": "Claim the Shard of Clarity",
          "type": "collect",
          "item_id": "shard_of_clarity",
          "count": 1
        }
      ],
      "reward": {
        "xp": 1500,
        "items": ["shard_of_clarity"],
        "salt_scrip": 3000
      },
      "criteria": {
        "requires_quests_completed": ["prime_lens_prophecy"]
      }
    },
    {
      "id": "shard_of_will",
      "name": "The Shard of Will",
      "description": "Seek the Shard of Will in the Magma-Glass Caverns beneath the Iron Covenant's fortress. Face the Forge-Beast to claim the Body aspect.",
      "category": "main",
      "act": 4,
      "objectives": [
        {
          "id": "enter_magma_caverns",
          "description": "Enter the Magma-Glass Caverns",
          "type": "reach",
          "x": 200,
          "y": 100
        },
        {
          "id": "defeat_forge_beast",
          "description": "Defeat the Forge-Beast",
          "type": "kill",
          "enemy_id": "forge_beast",
          "count": 1
        },
        {
          "id": "claim_will_shard",
          "description": "Claim the Shard of Will",
          "type": "collect",
          "item_id": "shard_of_will",
          "count": 1
        }
      ],
      "reward": {
        "xp": 1500,
        "items": ["shard_of_will"],
        "salt_scrip": 3000
      },
      "criteria": {
        "requires_quests_completed": ["prime_lens_prophecy"]
      }
    },
    {
      "id": "shard_of_soul",
      "name": "The Shard of Soul",
      "description": "Seek the Shard of Soul worn by the High Prism in the shifting Glass Gardens. Face the High Prism to claim the Spirit aspect.",
      "category": "main",
      "act": 4,
      "objectives": [
        {
          "id": "enter_glass_gardens",
          "description": "Enter the Glass Gardens",
          "type": "reach",
          "x": 100,
          "y": 200
        },
        {
          "id": "confront_high_prism",
          "description": "Confront the High Prism",
          "type": "talk_to",
          "npc_id": "high_prism"
        },
        {
          "id": "claim_soul_shard",
          "description": "Claim the Shard of Soul",
          "type": "collect",
          "item_id": "shard_of_soul",
          "count": 1
        }
      ],
      "reward": {
        "xp": 1500,
        "items": ["shard_of_soul"],
        "salt_scrip": 3000,
        "unlocks_quests": ["vector_choice"]
      },
      "criteria": {
        "requires_quests_completed": ["prime_lens_prophecy"]
      }
    },
    {
      "id": "vector_choice",
      "name": "The Vector Choice",
      "description": "With all three Prime Lens Aspects, approach the Vector Spire. Choose the fate of the Heliograph Network and humanity's future.",
      "category": "main",
      "act": 4,
      "objectives": [
        {
          "id": "reach_vector_spire",
          "description": "Reach the Vector Spire",
          "type": "reach",
          "x": 250,
          "y": 250
        },
        {
          "id": "reconstruct_prime_lens",
          "description": "Reconstruct the Prime Lens from its three Aspects",
          "type": "collect",
          "item_id": "prime_lens_complete",
          "count": 1
        },
        {
          "id": "make_final_choice",
          "description": "Choose the fate of the Heliograph Network",
          "type": "talk_to",
          "npc_id": "the_architect"
        }
      ],
      "reward": {
        "xp": 5000,
        "items": ["prime_lens_complete"],
        "salt_scrip": 10000
      },
      "criteria": {
        "requires_quests_completed": ["shard_of_clarity", "shard_of_will", "shard_of_soul"],
        "required_items": ["shard_of_clarity", "shard_of_will", "shard_of_soul"]
      }
    }
  ],
  "quest_content_injections": [
    {
      "quest_id": "pilgrims_last_angle",
      "npcs": [
        {
          "npc_id": "dying_pilgrim",
          "placement_strategy": {
            "type": "biome_type",
            "biome": "Saltflat"
          },
          "condition": {
            "type": "quest_available"
          }
        }
      ],
      "items": [
        {
          "item_id": "scripture_shard",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Ruins",
            "max_distance": 5
          },
          "condition": {
            "type": "quest_active"
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_monks",
      "npcs": [
        {
          "npc_id": "brother_halix",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Shrine",
            "max_distance": 3
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Mirror Monks",
            "min_rep": 25
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_engineers",
      "npcs": [
        {
          "npc_id": "forewoman_ressa",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Town",
            "max_distance": 2
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Sand-Engineers", 
            "min_rep": 25
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_glassborn",
      "npcs": [
        {
          "npc_id": "sable_of_the_seam",
          "placement_strategy": {
            "type": "biome_type",
            "biome": "Ruins"
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Glassborn",
            "min_rep": 25
          }
        }
      ]
    }
  ]
}
