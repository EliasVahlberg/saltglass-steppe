{
  "main_questline": [
    {
      "id": "pilgrims_last_angle",
      "name": "The Pilgrim's Last Angle",
      "description": "A dying pilgrim speaks of doors that still remember and angles that reveal truth. Find their cache before the next storm overwrites the path.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "find_dying_pilgrim",
          "description": "Find the dying pilgrim in the salt wastes",
          "type": "talk_to",
          "npc_id": "dying_pilgrim"
        },
        {
          "id": "recover_cache",
          "description": "Recover the pilgrim's cache before the storm",
          "type": "collect",
          "item_id": "scripture_shard",
          "count": 1
        }
      ],
      "reward": {
        "xp": 50,
        "items": ["scripture_shard"],
        "salt_scrip": 100,
        "unlocks_quests": ["the_broken_key"]
      },
      "criteria": {
        "requires_quests_completed": [],
        "custom_conditions": ["first_time_player"]
      }
    },
    {
      "id": "the_broken_key",
      "name": "The Broken Key",
      "description": "The scripture shard speaks of saint-keys and doors that remember. Investigate the ruins where the first key lies broken.",
      "category": "main", 
      "act": 1,
      "objectives": [
        {
          "id": "investigate_ruins",
          "description": "Investigate the vitrified library ruins",
          "type": "reach",
          "x": 50,
          "y": 50
        },
        {
          "id": "examine_broken_key",
          "description": "Examine the broken saint-key",
          "type": "collect",
          "item_id": "broken_saint_key",
          "count": 1
        }
      ],
      "reward": {
        "xp": 75,
        "items": ["broken_saint_key"],
        "salt_scrip": 150,
        "unlocks_quests": ["faction_choice_monks", "faction_choice_engineers", "faction_choice_glassborn"]
      },
      "criteria": {
        "requires_quests_completed": ["pilgrims_last_angle"]
      }
    },
    {
      "id": "faction_choice_monks",
      "name": "The Mirror Monk Path",
      "description": "Brother Halix offers to teach you the sacred angles. The Mirror Monks see patterns in the storm that others cannot.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_halix",
          "description": "Speak with Brother Halix about the sacred angles",
          "type": "talk_to",
          "npc_id": "brother_halix"
        },
        {
          "id": "storm_walk_ritual",
          "description": "Complete the storm-walk ritual during a glass storm",
          "type": "reach",
          "x": 25,
          "y": 25
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["sacred_angle_lens"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Mirror Monks": 25
        },
        "max_faction_reputation": {
          "Sand-Engineers": 50,
          "Glassborn": 50
        }
      }
    },
    {
      "id": "faction_choice_engineers", 
      "name": "The Sand-Engineer Path",
      "description": "Forewoman Ressa Vane offers practical solutions. The Sand-Engineers believe in controlling the storms through technology.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_ressa",
          "description": "Speak with Forewoman Ressa Vane about storm forecasting",
          "type": "talk_to",
          "npc_id": "forewoman_ressa"
        },
        {
          "id": "build_forecast_tool",
          "description": "Gather components to build a storm forecast instrument",
          "type": "collect",
          "item_id": "forecast_instrument",
          "count": 1
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["forecast_instrument", "spoof_module"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Sand-Engineers": 25
        },
        "max_faction_reputation": {
          "Mirror Monks": 50,
          "Glassborn": 50
        }
      }
    },
    {
      "id": "faction_choice_glassborn",
      "name": "The Glassborn Path", 
      "description": "Sable-of-the-Seam speaks of kinship and transformation. The Glassborn embrace the storm's changes.",
      "category": "main",
      "act": 1,
      "objectives": [
        {
          "id": "speak_with_sable",
          "description": "Speak with Sable-of-the-Seam about the crucible rites",
          "type": "talk_to",
          "npc_id": "sable_of_the_seam"
        },
        {
          "id": "crucible_rite",
          "description": "Survive a high-intensity storm in the marked crucible zone",
          "type": "reach",
          "x": 75,
          "y": 75
        }
      ],
      "reward": {
        "xp": 100,
        "items": ["storm_glass"],
        "salt_scrip": 200
      },
      "criteria": {
        "requires_quests_completed": ["the_broken_key"],
        "min_faction_reputation": {
          "Glassborn": 25
        },
        "max_faction_reputation": {
          "Mirror Monks": 50,
          "Sand-Engineers": 50
        },
        "min_refraction": 50
      }
    },
    {
      "id": "the_second_key",
      "name": "The Second Key",
      "description": "With faction backing, seek an intact saint-key. Each faction offers a different path to this crucial artifact.",
      "category": "main",
      "act": 2,
      "objectives": [
        {
          "id": "acquire_intact_key",
          "description": "Acquire an intact saint-key through your chosen faction",
          "type": "collect",
          "item_id": "saint_key",
          "count": 1
        }
      ],
      "reward": {
        "xp": 200,
        "items": ["saint_key"],
        "salt_scrip": 500,
        "unlocks_quests": ["custodians_query"]
      },
      "criteria": {
        "requires_quests_completed": ["faction_choice_monks", "faction_choice_engineers", "faction_choice_glassborn"],
        "custom_conditions": ["has_faction_alignment"]
      }
    },
    {
      "id": "custodians_query",
      "name": "The Custodian's Query",
      "description": "With a saint-key in hand, approach Custodian IRI-7 in the Deep Archive. Prepare to learn the truth of White Noon.",
      "category": "main",
      "act": 3,
      "objectives": [
        {
          "id": "enter_deep_archive",
          "description": "Enter the Deep Archive Wing",
          "type": "reach",
          "x": 100,
          "y": 100
        },
        {
          "id": "interface_with_custodian",
          "description": "Interface with Custodian IRI-7",
          "type": "talk_to",
          "npc_id": "custodian_iri_7"
        }
      ],
      "reward": {
        "xp": 500,
        "salt_scrip": 1000,
        "unlocks_quests": ["white_noon_revelation"]
      },
      "criteria": {
        "requires_quests_completed": ["the_second_key"],
        "required_items": ["saint_key"],
        "custom_conditions": ["in_deep_archive"]
      }
    }
  ],
  "quest_content_injections": [
    {
      "quest_id": "pilgrims_last_angle",
      "npcs": [
        {
          "npc_id": "dying_pilgrim",
          "placement_strategy": {
            "type": "biome_type",
            "biome": "Saltflat"
          },
          "condition": {
            "type": "quest_available"
          }
        }
      ],
      "items": [
        {
          "item_id": "scripture_shard",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Ruins",
            "max_distance": 5
          },
          "condition": {
            "type": "quest_active"
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_monks",
      "npcs": [
        {
          "npc_id": "brother_halix",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Shrine",
            "max_distance": 3
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Mirror Monks",
            "min_rep": 25
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_engineers",
      "npcs": [
        {
          "npc_id": "forewoman_ressa",
          "placement_strategy": {
            "type": "near_poi",
            "poi_type": "Town",
            "max_distance": 2
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Sand-Engineers", 
            "min_rep": 25
          }
        }
      ]
    },
    {
      "quest_id": "faction_choice_glassborn",
      "npcs": [
        {
          "npc_id": "sable_of_the_seam",
          "placement_strategy": {
            "type": "biome_type",
            "biome": "Ruins"
          },
          "condition": {
            "type": "faction_reputation",
            "faction": "Glassborn",
            "min_rep": 25
          }
        }
      ]
    }
  ]
}
